# Пакетная конвертация Lottie в Video

Этот скрипт автоматически конвертирует все JSON файлы из папки `models` в видео файлы.

## Установка

1. Установите Node.js (если еще не установлен): https://nodejs.org/

2. Установите зависимости:
```bash
npm install
```

## Использование

### Конвертация всех файлов в папке models:
```bash
npm run convert
```
или
```bash
node convert-all.js
```

### Конвертация только одной папки (для тестирования):
```bash
node convert-folder.js models/5167939598143193218
```

### Конвертация с кастомными параметрами:
```bash
node convert-folder.js models/5167939598143193218 --codec=vp8 --bitrate=8000 --output=my_videos
```

### Для Windows - просто запустите:
```
convert-all.bat
```

## Конфигурация

Откройте файл `convert-all.js` и измените параметры в объекте `CONFIG`:

```javascript
const CONFIG = {
    modelsDir: './models',                // Папка с JSON файлами
    outputDir: './output',                // Папка для сохранения видео
    htmlPath: './convert-headless.html',  // Путь к HTML файлу
    codec: 'video/webm;codecs="vp9"',     // Кодек видео
    extension: '.webm',                   // Расширение файла
    framerate: null,                      // null = автоопределение
    speed: 1,                             // Скорость воспроизведения
    bitrate: 5120,                        // Битрейт в kbps
    width: null,                          // null = автоопределение
    height: null,                         // null = автоопределение
};
```

## Поддерживаемые кодеки

- **VP9** (рекомендуется): `video/webm;codecs="vp9"` с расширением `.webm`
- **VP8**: `video/webm;codecs="vp8"` с расширением `.webm`
- **H.264**: `video/mp4;codecs="avc1"` с расширением `.mp4`

VP8 и VP9 поддерживают прозрачность.

## Структура выходных файлов

Скрипт сохраняет структуру папок из `models/`:
```
models/
  5167939598143193218/
    Aetheris.lottie.json
    
output/
  5167939598143193218/
    Aetheris.lottie.webm
```

## Особенности

- Автоматически пропускает уже сконвертированные файлы
- Показывает прогресс конвертации
- Логирует ошибки для каждого файла
- Работает в headless режиме браузера
- Поддерживает рекурсивный обход папок

## Устранение проблем

### Браузер не запускается
Если Puppeteer не может запустить браузер, попробуйте:
```bash
npm install puppeteer --force
```

### Слишком долгая конвертация
Уменьшите битрейт или используйте более быстрый кодек (VP8 вместо VP9).

### Недостаточно памяти
Скрипт обрабатывает файлы последовательно, но если возникают проблемы:
- Закройте другие программы
- Увеличьте лимит памяти Node.js: `node --max-old-space-size=4096 convert-all.js`

## Статистика

После завершения работы скрипт выведет:
- Количество сконвертированных файлов
- Количество пропущенных файлов
- Количество ошибок
- Общее количество обработанных файлов

